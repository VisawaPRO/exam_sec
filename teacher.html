<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏π</title>
<link rel="stylesheet" href="style.css">
</head>

<body>
<header>üë©‚Äçüè´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï</header>

<div class="container">

<div class="card">
  <input id="formLink" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Form (‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏Å‡∏ï‡∏¥)">
  <br><br>
  <button onclick="generateLink()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
  <br><br>
  <div id="examLink"></div>
</div>

<div class="card">
  <button onclick="resetAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏•‡∏ö</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>
</div>

</div>

<script>
let students = JSON.parse(localStorage.getItem("students") || "{}")

function generateLink(){
  const form = document.getElementById("formLink").value.trim()
  if(!form){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Google Form")
    return
  }

  // ‚≠ê ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub Pages (‡∏Å‡∏±‡∏ô 404)
  const base =
    location.origin + location.pathname.replace(/\/[^\/]*$/, "/")

  const examURL =
    base + "exam.html?form=" + encodeURIComponent(form)

  document.getElementById("examLink").innerHTML = `
    <b>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</b>
    <textarea>${examURL}</textarea>
  `
}

function render(){
  const tb = document.getElementById("list")
  tb.innerHTML = ""
  Object.keys(students).forEach(n=>{
    tb.innerHTML += `
      <tr>
        <td>${n}</td>
        <td class="${students[n]>0?'alert':'ok'}">${students[n]}</td>
        <td>${students[n]>0?'‚ö†Ô∏è ‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï':'‚úî ‡∏õ‡∏Å‡∏ï‡∏¥'}</td>
        <td><button onclick="removeName('${n}')">‚ùå</button></td>
      </tr>
    `
  })
}

function removeName(n){
  delete students[n]
  save()
}

function resetAll(){
  if(confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){
    students = {}
    save()
  }
}

function save(){
  localStorage.setItem("students", JSON.stringify(students))
  render()
}

render()
</script>
</body>
</html>
